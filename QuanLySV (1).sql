CREATE DATABASE QuanLySV
USE QuanLySV

CREATE TABLE KHOA(
MAKHOA CHAR(4) PRIMARY KEY,
TENKHOA NVARCHAR(100) NOT NULL,
NAMTHANHLAP INT NOT NULL
)
CREATE TABLE SVIEN(
MASV CHAR(8) PRIMARY KEY,
TENSV NVARCHAR(100) NOT NULL,
NAMHIENTAI INT NOT NULL,
MAKHOA CHAR(4) CONSTRAINT FK_MAKHOA_SVIEN FOREIGN KEY (MAKHOA) REFERENCES KHOA(MAKHOA)
)
CREATE TABLE MHOC(
MAMH CHAR(6) PRIMARY KEY,
TENMH NVARCHAR(100) NOT NULL,
TINCHI INT NOT NULL,
MAKHOA CHAR(4) CONSTRAINT FK_MAKHOA_MHOC FOREIGN KEY (MAKHOA) REFERENCES KHOA(MAKHOA)
)
CREATE TABLE DKIEN(
MAMH CHAR(6) NOT NULL CONSTRAINT FK_MAMH_MHOC FOREIGN KEY (MAMH) REFERENCES MHOC(MAMH),
MAMH_TRUOC CHAR(6) NOT NULL CONSTRAINT FK1_MAMH_MHOC FOREIGN KEY (MAMH_TRUOC) REFERENCES MHOC(MAMH),
PRIMARY KEY(MAMH, MAMH_TRUOC)
)
CREATE TABLE HPHAN(
MAHP INT PRIMARY KEY,
MAMH CHAR(6) NOT NULL CONSTRAINT FK2_MAMH_MHOC FOREIGN KEY (MAMH) REFERENCES MHOC(MAMH),
HOCKY INT NOT NULL,
NAMKHOAHOC INT NOT NULL,
GV NVARCHAR(60) NOT NULL
)
CREATE TABLE KQUA(
MASV CHAR(8) NOT NULL CONSTRAINT FK_MASV_SVIEN FOREIGN KEY (MASV) REFERENCES SVIEN(MASV),
MAHP INT NOT NULL CONSTRAINT FK_MAHP_HPAN FOREIGN KEY (MAHP) REFERENCES HPHAN(MAHP),
DIEM FLOAT NOT NULL,
PRIMARY KEY (MASV, MAHP)
)

INSERT INTO KHOA(MAKHOA, TENKHOA, NAMTHANHLAP)
VALUES ('TOAN', N'Toán', '1976'),
		('HOA', N'Hóa', '1980'),
		('SINH', N'Sinh', '1981'),
		('VLY', N'Vật lý', '1982')
INSERT INTO SVIEN(MASV, TENSV, NAMHIENTAI, MAKHOA)
VALUES ('K27.0017', N'Nguyễn Công Phú', '1', 'TOAN'),
		('K26.0008', N'Phan Anh Khang', '2', 'TOAN'),
		('K25.0005', N'Lý Thành', '3', 'HOA'),
		('K27.0018', N'Hàn Quốc Việt', '2', 'VLY')
INSERT INTO MHOC(MAMH, TENMH, TINCHI, MAKHOA)
VALUES ('TH0001', N'Tin học đại cương A1', '4', 'TOAN'),
		('TH0002', N'Cấu trúc dữ liệu', '4', 'TOAN'),
		('TO0001', N'Toán rời rạc', '3', 'TOAN'),
		('HH0001', N'Hóa đại cương A1', '5', 'HOA'),
		('HH0002', N'Hóa đại cương A2', '5', 'HOA'),
		('VL0002', N'Vật lý đại cương A2', '4', 'VLY'),
		('TH0003', N'Cơ sở dữ liệu', '5', 'TOAN'),
		('VL0001', N'Vật lý đại cương A1', '5', 'VLY')
INSERT INTO DKIEN(MAMH, MAMH_TRUOC)
VALUES ('TH0003', 'TO0001'),
		('TH0003', 'TH0002'),
		('TH0002', 'TH0001'),
		('HH0002', 'HH0001'),
		('VL0002', 'VL0001')
INSERT INTO HPHAN(MAHP, MAMH, HOCKY, NAMKHOAHOC, GV)
VALUES ('1', 'TH0001', '1', '1996', N'N.D.Lâm'),
		('2', 'VL0001', '1', '1996', N'T.N.Dung'),
		('3', 'TH0002', '1', '1997', N'H.Tuân'),
		('4', 'TH0001', '1', '1997', N'N.D.Lâm'),
		('5', 'TH0003', '2', '1997', N'N.C.Phú'),
		('6', 'HH0001', '1', '1996', N'L.T.Phúc'),
		('7', 'TH0002', '1', '1998', N'P.T.Như'),
		('8', 'TO0001', '1', '1996', N'N.C.Phú')
INSERT INTO KQUA(MASV, MAHP, DIEM)
VALUES ('K27.0017', '4', '9.5'),
		('K26.0008', '1', '10'),
		('K25.0005', '6', '6'),
		('K27.0018', '2', '8'),
		('K26.0008', '3', '9')

INSERT INTO SVIEN(MASV, TENSV, NAMHIENTAI, MAKHOA)
VALUES ('K26.0009', N'Nguyễn Thùy Linh', '2', 'SINH')

INSERT INTO SVIEN(MASV, TENSV, NAMHIENTAI, MAKHOA)
VALUES ('K26.0010', N'Nguyễn Anh Thư', '2', 'AVAN')

INSERT INTO KQUA(MASV, MAHP, DIEM)
VALUES ('K27.0017', '6', '7'),
		('K27.0017', '8', '9')

UPDATE KQUA
SET MAHP= '7', DIEM = '7'
WHERE MAHP='4'

DELETE FROM KQUA WHERE MASV='K26.0008' AND MAHP='3' AND DIEM='9'

SELECT * FROM HPHAN
SELECT * FROM KQUA WHERE DIEM >= 5